<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元素周期表 - API动态数据版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
        }
        
        /* 头部样式 */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #1a237e, #311b92);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        
        /* 控制面板 */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .control-group {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #1a237e;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }
        
        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .category-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            color: #555;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, #1a237e, #311b92);
            color: white;
            border-color: #1a237e;
        }
        
        /* 主内容区 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 1200px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        /* 周期表区域 */
        .periodic-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .periodic-section h2 {
            color: #1a237e;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .periodic-table-container {
            width: 100%;
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 4px;
            min-width: 900px;
        }
        
        .element-cell {
            position: relative;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px 5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            user-select: none;
        }
        
        .element-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .element-cell.selected {
            transform: scale(1.08);
            box-shadow: 0 0 0 4px #1a237e, 0 15px 35px rgba(26, 35, 126, 0.4);
            border-color: #1a237e;
            z-index: 20;
        }
        
        .element-number {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 0.75rem;
            font-weight: bold;
            color: #666;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .element-symbol {
            font-size: 1.2rem;
            font-weight: bold;
            color: #222;
            margin-bottom: 3px;
        }
        
        .element-name {
            font-size: 0.7rem;
            color: #666;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .element-mass {
            font-size: 0.65rem;
            color: #1a237e;
            background: rgba(26, 35, 126, 0.1);
            padding: 2px 6px;
            border-radius: 8px;
            margin-top: 3px;
        }
        
        /* 元素类别颜色 */
        .nonmetal { background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-color: #42a5f5; }
        .noble-gas { background: linear-gradient(135deg, #f3e5f5, #e1bee7); border-color: #ab47bc; }
        .alkali-metal { background: linear-gradient(135deg, #ffebee, #ffcdd2); border-color: #ef5350; }
        .alkaline-earth-metal { background: linear-gradient(135deg, #fff3e0, #ffcc80); border-color: #ffa726; }
        .metalloid { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-color: #66bb6a; }
        .halogen { background: linear-gradient(135deg, #fff8e1, #ffecb3); border-color: #ffca28; }
        .transition-metal { background: linear-gradient(135deg, #fce4ec, #f8bbd9); border-color: #ec407a; }
        .post-transition-metal { background: linear-gradient(135deg, #e0f7fa, #b2ebf2); border-color: #26c6da; }
        .lanthanide { background: linear-gradient(135deg, #e8eaf6, #c5cae9); border-color: #5c6bc0; }
        .actinide { background: linear-gradient(135deg, #f1f8e9, #dcedc8); border-color: #9ccc65; }
        
        .empty-cell {
            background: transparent;
            border: none;
            pointer-events: none;
        }
        
        .series-label {
            grid-column: 1 / span 18;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            padding: 12px;
            background: rgba(245, 245, 245, 0.9);
            border-radius: 10px;
            border: 2px dashed #ccc;
            margin: 5px 0;
        }
        
        /* 详情面板 */
        .detail-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .element-large {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a237e, #311b92);
            color: white;
            font-size: 2.2rem;
            font-weight: bold;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(26, 35, 126, 0.3);
            flex-shrink: 0;
        }
        
        .element-info h2 {
            font-size: 1.8rem;
            color: #222;
            margin-bottom: 5px;
        }
        
        .element-category {
            display: inline-block;
            padding: 6px 15px;
            background: rgba(26, 35, 126, 0.1);
            color: #1a237e;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        /* 原子模型 */
        .atom-model-container {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            text-align: center;
        }
        
        .atom-model {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .nucleus {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            border: 4px solid white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
            position: relative;
        }
        
        .electron-shell {
            position: absolute;
            border-radius: 50%;
            border: 2px dashed rgba(26, 35, 126, 0.3);
            animation: rotate 40s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .electron {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle at 30% 30%, #ffeb3b, #ff9800);
            border-radius: 50%;
            box-shadow: 0 0 10px #ffc107;
        }
        
        /* 属性网格 */
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .property-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #1a237e;
        }
        
        .property-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        .property-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #1a237e;
            display: block;
        }
        
        /* 加载状态 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(26, 35, 126, 0.1);
            border-top: 5px solid #1a237e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 状态消息 */
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .periodic-table {
                min-width: 700px;
            }
            
            .element-cell {
                min-height: 60px;
                padding: 8px 4px;
            }
            
            .element-symbol {
                font-size: 1rem;
            }
            
            .properties-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* 搜索高亮 */
        .search-highlight {
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 3px #ff9800, 0 10px 25px rgba(255, 152, 0, 0.3);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.4), 0 0 0 3px #ff9800; }
            70% { box-shadow: 0 0 0 10px rgba(255, 152, 0, 0), 0 0 0 3px #ff9800; }
            100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0), 0 0 0 3px #ff9800; }
        }
        
        /* 图例 */
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <h3 style="color: #1a237e; margin-bottom: 10px;">正在加载元素数据...</h3>
        <p style="color: #666; text-align: center; max-width: 300px;">
            从PubChem API获取最新的元素周期表数据
        </p>
    </div>
    
    <div class="container">
        <!-- 头部区域 -->
        <div class="header">
            <h1><i class="fas fa-atom"></i> 元素周期表 - API动态数据版</h1>
            <p class="subtitle">实时数据 | 无本地文件 | 解决电子重叠问题</p>
            
            <!-- 状态消息 -->
            <div class="status-message" id="statusMessage"></div>
            
            <!-- 控制面板 -->
            <div class="controls">
                <div class="control-group">
                    <input type="text" class="search-box" id="searchBox" 
                           placeholder="搜索元素名称、符号或原子序数...">
                </div>
                
                <div class="control-group">
                    <div class="category-buttons" id="categoryButtons">
                        <button class="category-btn active" data-category="all">全部元素</button>
                        <button class="category-btn" data-category="nonmetal">非金属</button>
                        <button class="category-btn" data-category="alkali-metal">碱金属</button>
                        <button class="category-btn" data-category="transition-metal">过渡金属</button>
                        <button class="category-btn" data-category="noble-gas">稀有气体</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 周期表区域 -->
            <div class="periodic-section">
                <h2><i class="fas fa-th"></i> 元素周期表 (1-118)</h2>
                
                <div class="periodic-table-container">
                    <div class="periodic-table" id="periodicTable">
                        <!-- 元素将通过JavaScript动态生成 -->
                    </div>
                    <div class="series-label">* 57-71 镧系元素</div>
                    <div class="series-label">† 89-103 锕系元素</div>
                </div>
                
                <p style="text-align: center; color: #666; margin-top: 15px;">
                    <i class="fas fa-mouse-pointer"></i> 点击元素查看详细信息
                </p>
            </div>
            
            <!-- 详情面板 -->
            <div class="detail-section" id="detailSection">
                <div class="detail-header">
                    <div class="element-large" id="largeSymbol">H</div>
                    <div class="element-info">
                        <h2 id="elementName">氢 <span id="elementSymbol" style="font-size: 1.4rem; color: #666;">(H)</span></h2>
                        <span class="element-category" id="elementCategory">非金属</span>
                    </div>
                </div>
                
                <!-- 原子模型 -->
                <div class="atom-model-container">
                    <h3 style="color: #1a237e; margin-bottom: 15px;">
                        <i class="fas fa-atom"></i> 原子模型
                    </h3>
                    <div class="atom-model" id="atomModel">
                        <div class="nucleus" id="nucleus">
                            <div id="protonCount">1</div>
                            <div style="font-size: 0.7rem;">质子</div>
                            <div id="neutronCount">0</div>
                            <div style="font-size: 0.7rem;">中子</div>
                        </div>
                        <!-- 电子层将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 元素属性 -->
                <div class="properties-grid">
                    <div class="property-item">
                        <span class="property-label">原子序数</span>
                        <span class="property-value" id="atomicNumber">1</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">原子质量</span>
                        <span class="property-value" id="atomicMass">1.008 u</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">原子半径</span>
                        <span class="property-value" id="atomicRadius">120 pm</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">电负性</span>
                        <span class="property-value" id="electronegativity">2.20</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">电子排布</span>
                        <span class="property-value" id="electronConfig">1s¹</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">标准状态</span>
                        <span class="property-value" id="standardState">气态</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">熔点</span>
                        <span class="property-value" id="meltingPoint">13.81 K</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">沸点</span>
                        <span class="property-value" id="boilingPoint">20.28 K</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">密度</span>
                        <span class="property-value" id="density">0.00008988 g/cm³</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">发现年份</span>
                        <span class="property-value" id="discoveryYear">1766</span>
                    </div>
                </div>
                
                <!-- 氧化态 -->
                <div style="margin-top: 20px;">
                    <h4 style="color: #1a237e; margin-bottom: 10px;">
                        <i class="fas fa-exchange-alt"></i> 氧化态
                    </h4>
                    <div id="oxidationStates" style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span style="background: #e8f4ff; padding: 6px 12px; border-radius: 15px; color: #1a237e; font-size: 0.9rem;">
                            +1
                        </span>
                        <span style="background: #e8f4ff; padding: 6px 12px; border-radius: 15px; color: #1a237e; font-size: 0.9rem;">
                            -1
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 图例 -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color nonmetal"></div>
                <span>非金属</span>
            </div>
            <div class="legend-item">
                <div class="legend-color noble-gas"></div>
                <span>稀有气体</span>
            </div>
            <div class="legend-item">
                <div class="legend-color alkali-metal"></div>
                <span>碱金属</span>
            </div>
            <div class="legend-item">
                <div class="legend-color alkaline-earth-metal"></div>
                <span>碱土金属</span>
            </div>
            <div class="legend-item">
                <div class="legend-color metalloid"></div>
                <span>准金属</span>
            </div>
            <div class="legend-item">
                <div class="legend-color halogen"></div>
                <span>卤素</span>
            </div>
            <div class="legend-item">
                <div class="legend-color transition-metal"></div>
                <span>过渡金属</span>
            </div>
            <div class="legend-item">
                <div class="legend-color post-transition-metal"></div>
                <span>后过渡金属</span>
            </div>
            <div class="legend-item">
                <div class="legend-color lanthanide"></div>
                <span>镧系元素</span>
            </div>
            <div class="legend-item">
                <div class="legend-color actinide"></div>
                <span>锕系元素</span>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let allElements = [];
        let currentElement = null;
        let filteredElements = [];
        
        // 元素位置映射（周期表中的位置）
        const elementPositions = {
            1: {row: 1, col: 1},
            2: {row: 1, col: 18},
            
            3: {row: 2, col: 1},
            4: {row: 2, col: 2},
            5: {row: 2, col: 13},
            6: {row: 2, col: 14},
            7: {row: 2, col: 15},
            8: {row: 2, col: 16},
            9: {row: 2, col: 17},
            10: {row: 2, col: 18},
            
            11: {row: 3, col: 1},
            12: {row: 3, col: 2},
            13: {row: 3, col: 13},
            14: {row: 3, col: 14},
            15: {row: 3, col: 15},
            16: {row: 3, col: 16},
            17: {row: 3, col: 17},
            18: {row: 3, col: 18},
            
            19: {row: 4, col: 1},
            20: {row: 4, col: 2},
            21: {row: 4, col: 3},
            22: {row: 4, col: 4},
            23: {row: 4, col: 5},
            24: {row: 4, col: 6},
            25: {row: 4, col: 7},
            26: {row: 4, col: 8},
            27: {row: 4, col: 9},
            28: {row: 4, col: 10},
            29: {row: 4, col: 11},
            30: {row: 4, col: 12},
            31: {row: 4, col: 13},
            32: {row: 4, col: 14},
            33: {row: 4, col: 15},
            34: {row: 4, col: 16},
            35: {row: 4, col: 17},
            36: {row: 4, col: 18},
            
            37: {row: 5, col: 1},
            38: {row: 5, col: 2},
            39: {row: 5, col: 3},
            40: {row: 5, col: 4},
            41: {row: 5, col: 5},
            42: {row: 5, col: 6},
            43: {row: 5, col: 7},
            44: {row: 5, col: 8},
            45: {row: 5, col: 9},
            46: {row: 5, col: 10},
            47: {row: 5, col: 11},
            48: {row: 5, col: 12},
            49: {row: 5, col: 13},
            50: {row: 5, col: 14},
            51: {row: 5, col: 15},
            52: {row: 5, col: 16},
            53: {row: 5, col: 17},
            54: {row: 5, col: 18},
            
            55: {row: 6, col: 1},
            56: {row: 6, col: 2},
            57: {row: 6, col: 3},
            72: {row: 6, col: 4},
            73: {row: 6, col: 5},
            74: {row: 6, col: 6},
            75: {row: 6, col: 7},
            76: {row: 6, col: 8},
            77: {row: 6, col: 9},
            78: {row: 6, col: 10},
            79: {row: 6, col: 11},
            80: {row: 6, col: 12},
            81: {row: 6, col: 13},
            82: {row: 6, col: 14},
            83: {row: 6, col: 15},
            84: {row: 6, col: 16},
            85: {row: 6, col: 17},
            86: {row: 6, col: 18},
            
            87: {row: 7, col: 1},
            88: {row: 7, col: 2},
            89: {row: 7, col: 3},
            104: {row: 7, col: 4},
            105: {row: 7, col: 5},
            106: {row: 7, col: 6},
            107: {row: 7, col: 7},
            108: {row: 7, col: 8},
            109: {row: 7, col: 9},
            110: {row: 7, col: 10},
            111: {row: 7, col: 11},
            112: {row: 7, col: 12},
            113: {row: 7, col: 13},
            114: {row: 7, col: 14},
            115: {row: 7, col: 15},
            116: {row: 7, col: 16},
            117: {row: 7, col: 17},
            118: {row: 7, col: 18},
            
            58: {row: 8, col: 3},
            59: {row: 8, col: 4},
            60: {row: 8, col: 5},
            61: {row: 8, col: 6},
            62: {row: 8, col: 7},
            63: {row: 8, col: 8},
            64: {row: 8, col: 9},
            65: {row: 8, col: 10},
            66: {row: 8, col: 11},
            67: {row: 8, col: 12},
            68: {row: 8, col: 13},
            69: {row: 8, col: 14},
            70: {row: 8, col: 15},
            71: {row: 8, col: 16},
            
            90: {row: 9, col: 3},
            91: {row: 9, col: 4},
            92: {row: 9, col: 5},
            93: {row: 9, col: 6},
            94: {row: 9, col: 7},
            95: {row: 9, col: 8},
            96: {row: 9, col: 9},
            97: {row: 9, col: 10},
            98: {row: 9, col: 11},
            99: {row: 9, col: 12},
            100: {row: 9, col: 13},
            101: {row: 9, col: 14},
            102: {row: 9, col: 15},
            103: {row: 9, col: 16}
        };
        
        // 类别映射
        const categoryMap = {
            'Nonmetal': 'nonmetal',
            'Noble Gas': 'noble-gas',
            'Alkali Metal': 'alkali-metal',
            'Alkaline Earth Metal': 'alkaline-earth-metal',
            'Metalloid': 'metalloid',
            'Halogen': 'halogen',
            'Transition Metal': 'transition-metal',
            'Post-Transition Metal': 'post-transition-metal',
            'Lanthanide': 'lanthanide',
            'Actinide': 'actinide'
        };
        
        // 中文类别名称
        const categoryNames = {
            'nonmetal': '非金属',
            'noble-gas': '稀有气体',
            'alkali-metal': '碱金属',
            'alkaline-earth-metal': '碱土金属',
            'metalloid': '准金属',
            'halogen': '卤素',
            'transition-metal': '过渡金属',
            'post-transition-metal': '后过渡金属',
            'lanthanide': '镧系元素',
            'actinide': '锕系元素'
        };
        
        // 状态映射
        const stateMap = {
            'Gas': '气态',
            'Liquid': '液态',
            'Solid': '固态'
        };
        
        // 元素名称映射（英文到中文）
        const elementNameMap = {
            'Hydrogen': '氢',
            'Helium': '氦',
            'Lithium': '锂',
            'Beryllium': '铍',
            'Boron': '硼',
            'Carbon': '碳',
            'Nitrogen': '氮',
            'Oxygen': '氧',
            'Fluorine': '氟',
            'Neon': '氖',
            'Sodium': '钠',
            'Magnesium': '镁',
            'Aluminum': '铝',
            'Silicon': '硅',
            'Phosphorus': '磷',
            'Sulfur': '硫',
            'Chlorine': '氯',
            'Argon': '氩',
            'Potassium': '钾',
            'Calcium': '钙',
            'Scandium': '钪',
            'Titanium': '钛',
            'Vanadium': '钒',
            'Chromium': '铬',
            'Manganese': '锰',
            'Iron': '铁',
            'Cobalt': '钴',
            'Nickel': '镍',
            'Copper': '铜',
            'Zinc': '锌',
            'Gallium': '镓',
            'Germanium': '锗',
            'Arsenic': '砷',
            'Selenium': '硒',
            'Bromine': '溴',
            'Krypton': '氪',
            'Rubidium': '铷',
            'Strontium': '锶',
            'Yttrium': '钇',
            'Zirconium': '锆',
            'Niobium': '铌',
            'Molybdenum': '钼',
            'Technetium': '锝',
            'Ruthenium': '钌',
            'Rhodium': '铑',
            'Palladium': '钯',
            'Silver': '银',
            'Cadmium': '镉',
            'Indium': '铟',
            'Tin': '锡',
            'Antimony': '锑',
            'Tellurium': '碲',
            'Iodine': '碘',
            'Xenon': '氙',
            'Cesium': '铯',
            'Barium': '钡',
            'Lanthanum': '镧',
            'Cerium': '铈',
            'Praseodymium': '镨',
            'Neodymium': '钕',
            'Promethium': '钷',
            'Samarium': '钐',
            'Europium': '铕',
            'Gadolinium': '钆',
            'Terbium': '铽',
            'Dysprosium': '镝',
            'Holmium': '钬',
            'Erbium': '铒',
            'Thulium': '铥',
            'Ytterbium': '镱',
            'Lutetium': '镥',
            'Hafnium': '铪',
            'Tantalum': '钽',
            'Tungsten': '钨',
            'Rhenium': '铼',
            'Osmium': '锇',
            'Iridium': '铱',
            'Platinum': '铂',
            'Gold': '金',
            'Mercury': '汞',
            'Thallium': '铊',
            'Lead': '铅',
            'Bismuth': '铋',
            'Polonium': '钋',
            'Astatine': '砹',
            'Radon': '氡',
            'Francium': '钫',
            'Radium': '镭',
            'Actinium': '锕',
            'Thorium': '钍',
            'Protactinium': '镤',
            'Uranium': '铀',
            'Neptunium': '镎',
            'Plutonium': '钚',
            'Americium': '镅',
            'Curium': '锔',
            'Berkelium': '锫',
            'Californium': '锎',
            'Einsteinium': '锿',
            'Fermium': '镄',
            'Mendelevium': '钔',
            'Nobelium': '锘',
            'Lawrencium': '铹',
            'Rutherfordium': '鑪',
            'Dubnium': '𨧀',
            'Seaborgium': '𨭎',
            'Bohrium': '𨨏',
            'Hassium': '𨭆',
            'Meitnerium': '䥑',
            'Darmstadtium': '鐽',
            'Roentgenium': '錀',
            'Copernicium': '鎶',
            'Nihonium': '鉨',
            'Flerovium': '鈇',
            'Moscovium': '镆',
            'Livermorium': '鉝',
            'Tennessine': '鿬',
            'Oganesson': '鿫'
        };
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', () => {
            loadElementsFromAPI();
            setupEventListeners();
        });
        
        // 从PubChem API加载元素数据
        async function loadElementsFromAPI() {
            const apiUrl = 'https://pubchem.ncbi.nlm.nih.gov/rest/pug/periodictable/JSON?response_type=display';
            
            try {
                showStatus('正在从PubChem API获取最新元素数据...', 'info');
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                const data = await response.json();
                
                // 处理API返回的数据
                processAPIData(data);
                
                showStatus(`成功加载 ${allElements.length} 个元素数据`, 'success');
                
                // 渲染周期表
                renderPeriodicTable();
                
                // 设置默认选中的元素
                if (allElements.length > 0) {
                    selectElement(allElements[0]);
                }
                
                // 隐藏加载动画
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 500);
                
            } catch (error) {
                console.error('加载元素数据失败:', error);
                showStatus(`加载失败: ${error.message}。正在使用备用数据...`, 'error');
                
                // 使用备用数据
                useFallbackData();
            }
        }
        
        // 处理API返回的数据
        function processAPIData(data) {
            allElements = [];
            
            // PubChem API返回的数据结构：data.Table.Row数组
            const rows = data.Table.Row;
            
            rows.forEach(row => {
                const cell = row.Cell;
                
                // 根据PubChem API文档，cell数组索引对应属性：
                // 0: 原子序数, 1: 符号, 2: 名称, 3: 原子量, 4: 颜色, 5: 电子排布,
                // 6: 电负性, 7: 原子半径, 8: 电离能, 9: 电子亲和能,
                // 10: 氧化态, 11: 标准状态, 12: 熔点, 13: 沸点, 14: 密度,
                // 15: 组块, 16: 发现年份
                
                const element = {
                    atomicNumber: parseInt(cell[0]) || 0,
                    symbol: cell[1] || '',
                    name: cell[2] || '',
                    atomicMass: parseFloat(cell[3]) || 0,
                    cpkHexColor: cell[4] || '#cccccc',
                    electronConfiguration: cell[5] || '',
                    electronegativity: parseFloat(cell[6]) || null,
                    atomicRadius: parseFloat(cell[7]) || null,
                    ionizationEnergy: parseFloat(cell[8]) || null,
                    electronAffinity: parseFloat(cell[9]) || null,
                    oxidationStates: cell[10] || '',
                    standardState: cell[11] || '',
                    meltingPoint: parseFloat(cell[12]) || null,
                    boilingPoint: parseFloat(cell[13]) || null,
                    density: parseFloat(cell[14]) || null,
                    groupBlock: cell[15] || '',
                    yearDiscovered: cell[16] || ''
                };
                
                // 计算类别
                element.category = categoryMap[element.groupBlock] || 'unknown';
                
                // 添加中文名称
                element.chineseName = elementNameMap[element.name] || element.name;
                
                allElements.push(element);
            });
            
            // 按原子序数排序
            allElements.sort((a, b) => a.atomicNumber - b.atomicNumber);
        }
        
        // 备用数据（API失败时使用）
        function useFallbackData() {
            // 简化的备用数据（前20个元素）
            allElements = [
                {
                    atomicNumber: 1, symbol: "H", name: "Hydrogen", chineseName: "氢",
                    atomicMass: 1.008, category: "nonmetal", electronConfiguration: "1s1",
                    electronegativity: 2.2, atomicRadius: 120, ionizationEnergy: 13.598,
                    oxidationStates: "+1, -1", standardState: "Gas", meltingPoint: 13.81,
                    boilingPoint: 20.28, density: 0.00008988, yearDiscovered: "1766"
                },
                {
                    atomicNumber: 2, symbol: "He", name: "Helium", chineseName: "氦",
                    atomicMass: 4.0026, category: "noble-gas", electronConfiguration: "1s2",
                    electronegativity: null, atomicRadius: 140, ionizationEnergy: 24.587,
                    oxidationStates: "", standardState: "Gas", meltingPoint: 0.95,
                    boilingPoint: 4.22, density: 0.0001785, yearDiscovered: "1868"
                },
                // 可以继续添加更多备用元素数据...
            ];
            
            renderPeriodicTable();
            
            if (allElements.length > 0) {
                selectElement(allElements[0]);
            }
            
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 500);
        }
        
        // 渲染周期表
        function renderPeriodicTable() {
            const table = document.getElementById('periodicTable');
            table.innerHTML = '';
            
            // 创建10行x18列的网格
            for (let row = 1; row <= 10; row++) {
                for (let col = 1; col <= 18; col++) {
                    const cell = document.createElement('div');
                    
                    // 检查是否为标注行
                    if ((row === 8 || row === 9) && col === 1) {
                        // 这些行用于镧系和锕系标注，跳过单元格创建
                        continue;
                    }
                    
                    // 查找当前位置的元素
                    let element = null;
                    for (const [num, pos] of Object.entries(elementPositions)) {
                        const atomicNum = parseInt(num);
                        if (pos.row === row && pos.col === col) {
                            element = allElements.find(e => e.atomicNumber === atomicNum);
                            break;
                        }
                    }
                    
                    if (element) {
                        const isSelected = currentElement && currentElement.atomicNumber === element.atomicNumber;
                        let className = `element-cell ${element.category}`;
                        if (isSelected) className += ' selected';
                        
                        cell.className = className;
                        cell.dataset.atomicNumber = element.atomicNumber;
                        
                        cell.innerHTML = `
                            <div class="element-number">${element.atomicNumber}</div>
                            <div class="element-symbol">${element.symbol}</div>
                            <div class="element-name">${element.chineseName}</div>
                            <div class="element-mass">${element.atomicMass.toFixed(3)}</div>
                        `;
                        
                        table.appendChild(cell);
                    } else {
                        // 空白单元格
                        cell.className = 'empty-cell';
                        table.appendChild(cell);
                    }
                }
            }
            
            // 添加镧系和锕系标注
            const lanthanideLabel = document.createElement('div');
            lanthanideLabel.className = 'series-label';
            lanthanideLabel.textContent = '* 57-71 镧系元素';
            lanthanideLabel.style.gridRow = '8';
            lanthanideLabel.style.gridColumn = '3 / span 16';
            table.appendChild(lanthanideLabel);
            
            const actinideLabel = document.createElement('div');
            actinideLabel.className = 'series-label';
            actinideLabel.textContent = '† 89-103 锕系元素';
            actinideLabel.style.gridRow = '9';
            actinideLabel.style.gridColumn = '3 / span 16';
            table.appendChild(actinideLabel);
        }
        
        // 选择元素
        function selectElement(element) {
            if (!element) return;
            
            currentElement = element;
            updateElementDetail(element);
            
            // 更新周期表中的选中状态
            document.querySelectorAll('.element-cell').forEach(cell => {
                const atomicNum = parseInt(cell.dataset.atomicNumber);
                if (atomicNum === element.atomicNumber) {
                    cell.classList.add('selected');
                    
                    // 滚动到可见区域（移动端优化）
                    if (window.innerWidth < 768) {
                        cell.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                    }
                } else {
                    cell.classList.remove('selected');
                }
            });
        }
        
        // 更新元素详情
        function updateElementDetail(element) {
            // 基本信息
            document.getElementById('largeSymbol').textContent = element.symbol;
            document.getElementById('largeSymbol').className = `element-large ${element.category}`;
            document.getElementById('elementName').innerHTML = `${element.chineseName} <span>(${element.symbol})</span>`;
            document.getElementById('elementSymbol').textContent = `(${element.symbol})`;
            
            const categoryName = categoryNames[element.category] || element.category;
            document.getElementById('elementCategory').textContent = categoryName;
            
            // 原子数据
            document.getElementById('atomicNumber').textContent = element.atomicNumber;
            document.getElementById('atomicMass').textContent = `${element.atomicMass.toFixed(3)} u`;
            document.getElementById('atomicRadius').textContent = element.atomicRadius ? `${element.atomicRadius} pm` : '未知';
            
            // 格式化电子排布式
            const electronConfig = formatElectronConfig(element.electronConfiguration);
            document.getElementById('electronConfig').textContent = electronConfig;
            
            document.getElementById('electronegativity').textContent = 
                element.electronegativity ? element.electronegativity.toFixed(2) : '未知';
            
            document.getElementById('meltingPoint').textContent = 
                element.meltingPoint ? `${element.meltingPoint} K` : '未知';
            
            document.getElementById('boilingPoint').textContent = 
                element.boilingPoint ? `${element.boilingPoint} K` : '未知';
            
            document.getElementById('density').textContent = 
                element.density ? `${element.density.toExponential(3)} g/cm³` : '未知';
            
            document.getElementById('discoveryYear').textContent = element.yearDiscovered || '未知';
            
            // 标准状态
            const state = stateMap[element.standardState] || element.standardState || '未知';
            document.getElementById('standardState').textContent = state;
            
            // 原子核信息
            const protonCount = element.atomicNumber;
            const neutronCount = Math.round(element.atomicMass) - protonCount;
            document.getElementById('protonCount').textContent = protonCount;
            document.getElementById('neutronCount').textContent = neutronCount > 0 ? neutronCount : 0;
            
            // 更新原子模型
            updateAtomModel(element);
            
            // 更新氧化态
            updateOxidationStates(element);
        }
        
        // 格式化电子排布式
        function formatElectronConfig(config) {
            if (!config) return '未知';
            
            // 将数字上标转换为HTML上标
            return config
                .replace(/1/g, '¹')
                .replace(/2/g, '²')
                .replace(/3/g, '³')
                .replace(/4/g, '⁴')
                .replace(/5/g, '⁵')
                .replace(/6/g, '⁶')
                .replace(/7/g, '⁷')
                .replace(/8/g, '⁸')
                .replace(/9/g, '⁹')
                .replace(/0/g, '⁰');
        }
        
        // 更新原子模型（解决电子重叠问题）
        function updateAtomModel(element) {
            const atomModel = document.getElementById('atomModel');
            
            // 清除现有的电子层
            const existingShells = atomModel.querySelectorAll('.electron-shell');
            existingShells.forEach(shell => shell.remove());
            
            if (!element.electronConfiguration) return;
            
            // 解析电子排布式
            const electronConfig = element.electronConfiguration;
            const shells = parseElectronConfiguration(electronConfig, element.atomicNumber);
            
            // 原子核大小
            const nucleus = document.getElementById('nucleus');
            const totalNucleons = element.atomicNumber + Math.max(0, Math.round(element.atomicMass) - element.atomicNumber);
            const nucleusSize = Math.max(40, Math.min(60, 30 + Math.sqrt(totalNucleons) * 2));
            nucleus.style.width = `${nucleusSize}px`;
            nucleus.style.height = `${nucleusSize}px`;
            
            // 创建电子层
            shells.forEach((shell, index) => {
                if (shell.electrons === 0) return;
                
                // 计算半径（防止重叠）
                const radius = 40 + (index * 30);
                const shellDiv = document.createElement('div');
                shellDiv.className = 'electron-shell';
                shellDiv.style.width = `${radius * 2}px`;
                shellDiv.style.height = `${radius * 2}px`;
                shellDiv.style.animationDuration = `${30 + index * 10}s`;
                
                // 每层最多显示12个电子（防止视觉重叠）
                const displayElectrons = Math.min(shell.electrons, 12);
                
                // 创建电子
                for (let i = 0; i < displayElectrons; i++) {
                    const electron = document.createElement('div');
                    electron.className = 'electron';
                    
                    // 均匀分布电子
                    const angle = (i / displayElectrons) * 2 * Math.PI;
                    const x = radius * Math.cos(angle);
                    const y = radius * Math.sin(angle);
                    
                    electron.style.left = `calc(50% + ${x}px - 6px)`;
                    electron.style.top = `calc(50% + ${y}px - 6px)`;
                    
                    shellDiv.appendChild(electron);
                }
                
                atomModel.appendChild(shellDiv);
            });
        }
        
        // 解析电子排布式
        function parseElectronConfiguration(config, atomicNumber) {
            const shells = [];
            
            // 简化的电子层解析
            // 实际应用中，这里需要更复杂的解析逻辑
            // 这里我们根据原子序数创建近似电子层
            
            const shellCapacities = [2, 8, 18, 32, 32, 18, 8];
            let remainingElectrons = atomicNumber;
            let shellIndex = 0;
            
            while (remainingElectrons > 0 && shellIndex < shellCapacities.length) {
                const capacity = shellCapacities[shellIndex];
                const electronsInShell = Math.min(capacity, remainingElectrons);
                
                shells.push({
                    shell: shellIndex + 1,
                    electrons: electronsInShell,
                    capacity: capacity
                });
                
                remainingElectrons -= electronsInShell;
                shellIndex++;
            }
            
            return shells;
        }
        
        // 更新氧化态
        function updateOxidationStates(element) {
            const container = document.getElementById('oxidationStates');
            container.innerHTML = '';
            
            if (!element.oxidationStates || element.oxidationStates.trim() === '') {
                const span = document.createElement('span');
                span.textContent = '无数据';
                span.style.cssText = 'color: #999; font-style: italic;';
                container.appendChild(span);
                return;
            }
            
            const states = element.oxidationStates.split(',').map(s => s.trim());
            
            states.forEach(state => {
                if (state) {
                    const span = document.createElement('span');
                    span.textContent = state;
                    span.style.cssText = 'background: #e8f4ff; padding: 6px 12px; border-radius: 15px; color: #1a237e; font-size: 0.9rem;';
                    container.appendChild(span);
                }
            });
        }
        
        // 显示状态消息
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            
            // 5秒后自动隐藏
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 元素点击事件
            document.getElementById('periodicTable').addEventListener('click', (e) => {
                const cell = e.target.closest('.element-cell');
                if (cell) {
                    const atomicNum = parseInt(cell.dataset.atomicNumber);
                    const element = allElements.find(e => e.atomicNumber === atomicNum);
                    if (element) {
                        selectElement(element);
                    }
                }
            });
            
            // 搜索功能
            const searchBox = document.getElementById('searchBox');
            let searchTimeout;
            
            searchBox.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                
                searchTimeout = setTimeout(() => {
                    const query = searchBox.value.trim().toLowerCase();
                    
                    // 清除之前的高亮
                    document.querySelectorAll('.search-highlight').forEach(el => {
                        el.classList.remove('search-highlight');
                    });
                    
                    if (query.length === 0) return;
                    
                    // 搜索元素
                    const results = allElements.filter(element => 
                        element.name.toLowerCase().includes(query) ||
                        element.symbol.toLowerCase().includes(query) ||
                        element.chineseName.toLowerCase().includes(query) ||
                        element.atomicNumber.toString().includes(query)
                    );
                    
                    // 高亮匹配的元素
                    results.forEach(element => {
                        const cell = document.querySelector(`.element-cell[data-atomic-number="${element.atomicNumber}"]`);
                        if (cell) {
                            cell.classList.add('search-highlight');
                            
                            // 如果只有一个结果，自动选择它
                            if (results.length === 1) {
                                selectElement(element);
                            }
                        }
                    });
                }, 300);
            });
            
            // 分类筛选
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // 更新活动按钮
                    document.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    
                    const category = btn.dataset.category;
                    filterElementsByCategory(category);
                });
            });
        }
        
        // 按类别筛选元素
        function filterElementsByCategory(category) {
            document.querySelectorAll('.element-cell').forEach(cell => {
                const atomicNum = parseInt(cell.dataset.atomicNumber);
                const element = allElements.find(e => e.atomicNumber === atomicNum);
                
                if (!element) {
                    cell.style.opacity = '0.3';
                    cell.style.pointerEvents = 'none';
                    return;
                }
                
                let shouldShow = true;
                
                if (category !== 'all') {
                    shouldShow = element.category === category;
                }
                
                if (shouldShow) {
                    cell.style.opacity = '1';
                    cell.style.pointerEvents = 'auto';
                } else {
                    cell.style.opacity = '0.3';
                    cell.style.pointerEvents = 'none';
                }
            });
        }
    </script>
</body>
</html>
